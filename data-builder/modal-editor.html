<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Modal Content Editor - Crime Committer VI</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Courier New', monospace;
      background: #0a1628;
      color: #cccccc;
      padding: 20px;
      line-height: 1.4;
    }

    .container {
      max-width: 1600px;
      margin: 0 auto;
    }

    h1 {
      color: #00ffff;
      margin-bottom: 20px;
      text-align: center;
      text-shadow: 0 0 10px #00ffff;
    }

    .main-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }

    .panel {
      border: 2px solid #00ffff;
      padding: 15px;
      background: #000000;
      box-shadow: 0 0 20px rgba(0, 255, 255, 0.2);
    }

    .panel h2 {
      color: #00ffff;
      font-size: 16px;
      margin-bottom: 10px;
      text-transform: uppercase;
      text-shadow: 0 0 5px #00ffff;
    }

    .editor-container {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    textarea {
      width: 100%;
      min-height: 400px;
      background: #0a0a0a;
      color: #00ff00;
      border: 1px solid #00ffff;
      padding: 10px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      resize: vertical;
      line-height: 1.4;
    }

    textarea::placeholder {
      color: #555555;
    }

    .preview-container {
      background: #000000;
      border: 2px solid #00ffff;
      padding: 15px;
      min-height: 400px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      line-height: 1.4;
      overflow-x: auto;
      white-space: pre;
    }

    .controls {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    button {
      padding: 10px 15px;
      background: #00ffff;
      color: #000;
      border: none;
      font-family: 'Courier New', monospace;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.2s;
      text-shadow: none;
    }

    button:hover {
      background: #00cccc;
      transform: scale(1.02);
      box-shadow: 0 0 10px #00ffff;
    }

    button:active {
      transform: scale(0.98);
    }

    button.secondary {
      background: #ff00ff;
    }

    button.secondary:hover {
      background: #cc00cc;
      box-shadow: 0 0 10px #ff00ff;
    }

    .color-palette {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 5px;
      margin-top: 10px;
      max-height: 300px;
      overflow-y: auto;
      padding: 5px;
      background: #0a0a0a;
      border: 1px solid #00ffff;
    }

    .color-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 5px;
      cursor: pointer;
      border: 1px solid #333;
      transition: all 0.2s;
    }

    .color-item:hover {
      border-color: #00ffff;
      background: #1a1a1a;
    }

    .color-swatch {
      width: 20px;
      height: 20px;
      border: 1px solid #666;
      flex-shrink: 0;
    }

    .color-name {
      font-size: 11px;
      color: #888;
      flex-grow: 1;
    }

    .toolbar {
      display: flex;
      gap: 5px;
      flex-wrap: wrap;
      padding: 10px;
      background: #0a0a0a;
      border: 1px solid #00ffff;
      margin-bottom: 10px;
    }

    .toolbar button {
      padding: 5px 10px;
      font-size: 11px;
      background: #444;
      color: #fff;
    }

    .toolbar button:hover {
      background: #666;
    }

    .status {
      margin-top: 10px;
      padding: 10px;
      border-left: 3px solid #00ff00;
      background: #0a0a0a;
      color: #00ff00;
      font-weight: bold;
      display: none;
    }

    .status.show {
      display: block;
      animation: fadeIn 0.3s;
    }

    .status.error {
      border-left-color: #ff0000;
      color: #ff0000;
    }

    .status.success {
      border-left-color: #00ff00;
      color: #00ff00;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .info {
      grid-column: 1 / -1;
      padding: 15px;
      border: 1px solid #555555;
      background: #0a0a0a;
      color: #888888;
      font-size: 12px;
    }

    .info h3 {
      color: #00ffff;
      margin-bottom: 10px;
      font-size: 14px;
    }

    .info ul {
      margin-left: 20px;
      margin-bottom: 10px;
    }

    .info li {
      margin-bottom: 5px;
    }

    .info code {
      background: #1a1a1a;
      padding: 2px 5px;
      color: #00ff00;
      border: 1px solid #333;
    }

    .split-section {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 10px;
    }

    .gradient-controls {
      padding: 10px;
      background: #0a0a0a;
      border: 1px solid #00ffff;
      margin-bottom: 10px;
    }

    .gradient-controls label {
      display: block;
      margin-bottom: 5px;
      color: #00ffff;
      font-size: 11px;
    }

    .gradient-controls input,
    .gradient-controls select {
      width: 100%;
      padding: 5px;
      background: #1a1a1a;
      border: 1px solid #00ffff;
      color: #00ff00;
      font-family: 'Courier New', monospace;
      margin-bottom: 10px;
    }

    .modal-preview-box {
      border: 2px double #00ffff;
      padding: 20px;
      background: #000000;
      margin-top: 10px;
    }

    ::-webkit-scrollbar {
      width: 10px;
      height: 10px;
    }

    ::-webkit-scrollbar-track {
      background: #0a0a0a;
    }

    ::-webkit-scrollbar-thumb {
      background: #00ffff;
      border: 1px solid #000;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #00cccc;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>‚ö° MODAL CONTENT EDITOR ‚ö°</h1>

    <div class="main-grid">
      <!-- Left side: Editor -->
      <div class="panel">
        <h2>üìù Editor</h2>

        <div class="toolbar">
          <button onclick="insertMarkup('**', '**')" title="Bold text">Bold</button>
          <button onclick="insertMarkup('~~', '~~')" title="Dim text">Dim</button>
          <button onclick="insertMarkup('{{neon_cyan}}', '{{/}}')" title="Color text">Color</button>
          <button onclick="insertMarkup('{{bg:vga_blue}}', '{{/}}')" title="Background color">BG Color</button>
          <button onclick="showGradientHelper()" title="Insert gradient">Gradient</button>
          <button onclick="insertMarkup('\n\n', '')" title="Add blank line">Blank Line</button>
        </div>

        <div class="gradient-controls" id="gradientHelper" style="display: none;">
          <h3 style="color: #00ffff; margin-bottom: 10px;">Gradient Helper</h3>
          <label>Color A:</label>
          <select id="gradientColorA"></select>

          <label>Color B:</label>
          <select id="gradientColorB"></select>

          <label>Position (0.0 - 1.0):</label>
          <input type="number" id="gradientPos" min="0" max="1" step="0.01" value="0.5">

          <button onclick="insertGradient()">Insert Gradient</button>
          <button onclick="hideGradientHelper()" class="secondary">Cancel</button>
        </div>

        <textarea
          id="editor"
          placeholder="Type your modal content here...&#10;&#10;Use markup like:&#10;**bold text**&#10;~~dim text~~&#10;{{neon_cyan}}colored text{{/}}&#10;{{gradient:intro_a:intro_b:0.5}}gradient text{{/}}"
          oninput="updatePreview()"
        ></textarea>

        <div class="controls">
          <button onclick="copyJSON()">Copy as JSON</button>
          <button onclick="loadExample()" class="secondary">Load Example</button>
          <button onclick="clearEditor()" class="secondary">Clear</button>
        </div>

        <div id="status" class="status"></div>
      </div>

      <!-- Right side: Preview -->
      <div class="panel">
        <h2>üëÅÔ∏è Live Preview</h2>

        <div class="modal-preview-box">
          <div id="preview" class="preview-container">
            <span style="color: #555555;">Preview appears here...</span>
          </div>
        </div>
      </div>

      <!-- Color Palette -->
      <div class="panel">
        <h2>üé® Color Palette (Click to copy)</h2>
        <div class="color-palette" id="colorPalette"></div>
      </div>

      <!-- Info Panel -->
      <div class="info">
        <h3>Markup Reference</h3>
        <div class="split-section">
          <div>
            <strong>Text Formatting:</strong>
            <ul>
              <li><code>**text**</code> - Bold/bright white text</li>
              <li><code>~~text~~</code> - Dim gray text</li>
              <li><code>{{color_name}}text{{/}}</code> - Colored text</li>
              <li><code>{{bg:color_name}}text{{/}}</code> - Background color</li>
            </ul>
          </div>
          <div>
            <strong>Gradients:</strong>
            <ul>
              <li><code>{{gradient:colorA:colorB:0.5}}text{{/}}</code></li>
              <li>Position ranges from 0.0 (colorA) to 1.0 (colorB)</li>
              <li>Use for smooth color transitions in ASCII art</li>
              <li>Color names use lowercase with underscores</li>
            </ul>
          </div>
        </div>

        <h3 style="margin-top: 15px;">Tips</h3>
        <ul>
          <li>Use blank lines to add spacing between paragraphs</li>
          <li>Color tags can span multiple lines (newlines are converted to spaces)</li>
          <li>Click any color in the palette to copy its name</li>
          <li>The preview shows exactly how it will look in the game</li>
          <li>Copy as JSON to paste directly into modals.json</li>
        </ul>
      </div>
    </div>
  </div>

  <script>
    // Color palette from palette.js
    const PALETTE = {
      // Intro colors
      intro_a: "#fff7a4",
      intro_b: "#ff5e9f",
      logo: "#ff89a5",

      // Background colors
      black: "#000000",
      dark_blue: "#0a1628",
      darker_blue: "#1a2332",
      vga_blue: "#0000aa",
      vga_blue_dark: "#00007a",

      // Primary UI colors
      terminal_green: "#00ff00",
      terminal_green_dim: "#33ff33",
      terminal_green_dimmer: "#1a7a1a",
      neon_cyan: "#00ffff",
      neon_cyan_dim: "#006666",
      neon_teal: "#40e0d0",
      neon_teal_dim: "#1a5a52",

      // Accent colors
      hot_pink: "#ff00ff",
      hot_pink_dim: "#660066",
      magenta: "#ff1493",
      electric_orange: "#ff6600",
      electric_orange_dim: "#663300",
      bright_orange: "#ff8c00",
      bright_yellow: "#ffff00",

      // Semantic colors
      heat_orange: "#ff4500",
      heat_red: "#ff0000",
      success_green: "#00ff00",

      // Branch UI colors
      lava_red: "#ff3300",
      electric_blue: "#0066ff",
      gold: "#ffd700",

      // Text colors
      white: "#ffffff",
      light_gray: "#cccccc",
      mid_gray: "#888888",
      dim_gray: "#555555",

      // Branch backgrounds
      dark_green: "#002200",
      dark_cyan: "#001122"
    };

    // Color interpolation function
    function interpolateColor(color1, color2, t) {
      const r1 = parseInt(color1.slice(1, 3), 16);
      const g1 = parseInt(color1.slice(3, 5), 16);
      const b1 = parseInt(color1.slice(5, 7), 16);

      const r2 = parseInt(color2.slice(1, 3), 16);
      const g2 = parseInt(color2.slice(3, 5), 16);
      const b2 = parseInt(color2.slice(5, 7), 16);

      const r = Math.round(r1 + (r2 - r1) * t);
      const g = Math.round(g1 + (g2 - g1) * t);
      const b = Math.round(b1 + (b2 - b1) * t);

      const toHex = (n) => {
        const hex = n.toString(16);
        return hex.length === 1 ? '0' + hex : hex;
      };

      return `#${toHex(r)}${toHex(g)}${toHex(b)}`;
    }

    // Initialize color palette
    function initColorPalette() {
      const paletteEl = document.getElementById('colorPalette');
      const gradientColorA = document.getElementById('gradientColorA');
      const gradientColorB = document.getElementById('gradientColorB');

      for (const [name, color] of Object.entries(PALETTE)) {
        // Main palette
        const item = document.createElement('div');
        item.className = 'color-item';
        item.onclick = () => copyColorName(name);

        const swatch = document.createElement('div');
        swatch.className = 'color-swatch';
        swatch.style.backgroundColor = color;

        const nameEl = document.createElement('div');
        nameEl.className = 'color-name';
        nameEl.textContent = name;

        item.appendChild(swatch);
        item.appendChild(nameEl);
        paletteEl.appendChild(item);

        // Gradient selects
        const optionA = document.createElement('option');
        optionA.value = name;
        optionA.textContent = name;
        gradientColorA.appendChild(optionA);

        const optionB = document.createElement('option');
        optionB.value = name;
        optionB.textContent = name;
        gradientColorB.appendChild(optionB);
      }
    }

    // Copy color name to clipboard
    function copyColorName(name) {
      navigator.clipboard.writeText(name).then(() => {
        showStatus(`Copied: ${name}`, 'success');
      });
    }

    // Parse and render preview
    function updatePreview() {
      const content = document.getElementById('editor').value;
      const preview = document.getElementById('preview');

      if (!content.trim()) {
        preview.innerHTML = '<span style="color: #555555;">Preview appears here...</span>';
        return;
      }

      const html = parseContent(content);
      preview.innerHTML = html;
    }

    // Parse modal content with markup
    function parseContent(content) {
      let html = '';
      let pos = 0;

      while (pos < content.length) {
        // Check for **bold**
        if (content.substr(pos, 2) === '**') {
          const end = content.indexOf('**', pos + 2);
          if (end !== -1) {
            const text = content.substring(pos + 2, end);
            html += `<span style="color: #ffffff;">${escapeHtml(text)}</span>`;
            pos = end + 2;
            continue;
          }
        }

        // Check for ~~dim~~
        if (content.substr(pos, 2) === '~~') {
          const end = content.indexOf('~~', pos + 2);
          if (end !== -1) {
            const text = content.substring(pos + 2, end);
            html += `<span style="color: #555555;">${escapeHtml(text)}</span>`;
            pos = end + 2;
            continue;
          }
        }

        // Check for {{tag}}content{{/}}
        if (content.substr(pos, 2) === '{{') {
          const tagEnd = content.indexOf('}}', pos + 2);
          if (tagEnd !== -1) {
            const tag = content.substring(pos + 2, tagEnd);
            const contentEnd = content.indexOf('{{/}}', tagEnd + 2);

            if (contentEnd !== -1) {
              const text = content.substring(tagEnd + 2, contentEnd);

              // Check for gradient
              if (tag.startsWith('gradient:')) {
                const parts = tag.split(':');
                if (parts.length === 4) {
                  const colorA = PALETTE[parts[1]];
                  const colorB = PALETTE[parts[2]];
                  const t = parseFloat(parts[3]);

                  if (colorA && colorB && !isNaN(t)) {
                    const color = interpolateColor(colorA, colorB, t);
                    html += `<span style="color: ${color};">${escapeHtml(text)}</span>`;
                    pos = contentEnd + 5;
                    continue;
                  }
                }
              }
              // Check for background
              else if (tag.startsWith('bg:')) {
                const colorName = tag.substring(3);
                const color = PALETTE[colorName];
                if (color) {
                  html += `<span style="background-color: ${color};">${escapeHtml(text)}</span>`;
                  pos = contentEnd + 5;
                  continue;
                }
              }
              // Foreground color
              else {
                const color = PALETTE[tag];
                if (color) {
                  html += `<span style="color: ${color};">${escapeHtml(text)}</span>`;
                  pos = contentEnd + 5;
                  continue;
                }
              }
            }
          }
        }

        // Regular character
        const char = content[pos];
        if (char === '\n') {
          html += '\n';
        } else {
          html += escapeHtml(char);
        }
        pos++;
      }

      return html;
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Toolbar functions
    function insertMarkup(before, after) {
      const editor = document.getElementById('editor');
      const start = editor.selectionStart;
      const end = editor.selectionEnd;
      const text = editor.value;
      const selectedText = text.substring(start, end);

      const newText = text.substring(0, start) + before + selectedText + after + text.substring(end);
      editor.value = newText;
      editor.focus();
      editor.setSelectionRange(start + before.length, start + before.length + selectedText.length);

      updatePreview();
    }

    function showGradientHelper() {
      document.getElementById('gradientHelper').style.display = 'block';
    }

    function hideGradientHelper() {
      document.getElementById('gradientHelper').style.display = 'none';
    }

    function insertGradient() {
      const colorA = document.getElementById('gradientColorA').value;
      const colorB = document.getElementById('gradientColorB').value;
      const pos = document.getElementById('gradientPos').value;

      insertMarkup(`{{gradient:${colorA}:${colorB}:${pos}}}`, '{{/}}');
      hideGradientHelper();
    }

    // Export functions
    function copyJSON() {
      const content = document.getElementById('editor').value;
      if (!content.trim()) {
        showStatus('Editor is empty', 'error');
        return;
      }

      const escaped = content
        .replace(/\\/g, '\\\\')
        .replace(/"/g, '\\"')
        .replace(/\n/g, '\\n')
        .replace(/\t/g, '\\t');

      const json = `"${escaped}"`;

      navigator.clipboard.writeText(json).then(() => {
        showStatus('Copied as JSON! Ready to paste into modals.json', 'success');
      }).catch(() => {
        showStatus('Copy failed', 'error');
      });
    }

    function loadExample() {
      const example = `**COMMERCE BRANCH UNLOCKED**

You've gained enough {{neon_cyan}}reputation{{/}} to access higher-tier operations.

The {{hot_pink}}Commerce{{/}} branch offers:
‚Ä¢ Bigger scores
‚Ä¢ Higher risk
‚Ä¢ Better crew needed

{{success_green}}Your criminal empire is growing.{{/}}

~~Press any key to continue~~`;

      document.getElementById('editor').value = example;
      updatePreview();
      showStatus('Example loaded', 'success');
    }

    function clearEditor() {
      document.getElementById('editor').value = '';
      updatePreview();
    }

    function showStatus(message, type) {
      const status = document.getElementById('status');
      status.textContent = message;
      status.className = `status show ${type}`;
      setTimeout(() => {
        status.classList.remove('show');
      }, 3000);
    }

    // Initialize
    initColorPalette();
  </script>
</body>
</html>
